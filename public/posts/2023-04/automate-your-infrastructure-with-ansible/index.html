<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Automate Your Infrastructure With Ansible | NS</title>
<meta name=keywords content="ansible,automation,IaC,homelab,linux">
<meta name=description content="Automating your infrastructure with Ansible can be a game-changer for any organization looking to streamline their processes and reduce manual labor.
Intro Ansible is an open-source automation tool that allows you to automate tasks such as configuration management, application deployment, and orchestration of infrastructure resources, using a declarative language to describe the desired state of a system.
One of the key benefits of Ansible is its simplicity and ease of use.">
<meta name=author content="Angel">
<link rel=canonical href=/posts/2023-04/automate-your-infrastructure-with-ansible/>
<link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style>
<link rel=icon href=/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon.ico>
<link rel=mask-icon href=/favicon.ico>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H4GRFCYEJN"></script>
<script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-H4GRFCYEJN',{anonymize_ip:!1})}</script>
<meta property="og:title" content="Automate Your Infrastructure With Ansible">
<meta property="og:description" content="Automating your infrastructure with Ansible can be a game-changer for any organization looking to streamline their processes and reduce manual labor.
Intro Ansible is an open-source automation tool that allows you to automate tasks such as configuration management, application deployment, and orchestration of infrastructure resources, using a declarative language to describe the desired state of a system.
One of the key benefits of Ansible is its simplicity and ease of use.">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/2023-04/automate-your-infrastructure-with-ansible/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2023-04-06T16:35:08-05:00">
<meta property="article:modified_time" content="2023-04-06T16:35:08-05:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Automate Your Infrastructure With Ansible">
<meta name=twitter:description content="Automating your infrastructure with Ansible can be a game-changer for any organization looking to streamline their processes and reduce manual labor.
Intro Ansible is an open-source automation tool that allows you to automate tasks such as configuration management, application deployment, and orchestration of infrastructure resources, using a declarative language to describe the desired state of a system.
One of the key benefits of Ansible is its simplicity and ease of use.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"/posts/"},{"@type":"ListItem","position":3,"name":"Automate Your Infrastructure With Ansible","item":"/posts/2023-04/automate-your-infrastructure-with-ansible/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Automate Your Infrastructure With Ansible","name":"Automate Your Infrastructure With Ansible","description":"Automating your infrastructure with Ansible can be a game-changer for any organization looking to streamline their processes and reduce manual labor.\nIntro Ansible is an open-source automation tool that allows you to automate tasks such as configuration management, application deployment, and orchestration of infrastructure resources, using a declarative language to describe the desired state of a system.\nOne of the key benefits of Ansible is its simplicity and ease of use.","keywords":["ansible","automation","IaC","homelab","linux"],"articleBody":"Automating your infrastructure with Ansible can be a game-changer for any organization looking to streamline their processes and reduce manual labor.\nIntro Ansible is an open-source automation tool that allows you to automate tasks such as configuration management, application deployment, and orchestration of infrastructure resources, using a declarative language to describe the desired state of a system.\nOne of the key benefits of Ansible is its simplicity and ease of use.\nHere’s a quick overview from Fireship.io.\n   Components Inventory An Ansible inventory file is a configuration file that contains a list of hosts and groups that Ansible can manage. The inventory file specifies the target hosts that Ansible should execute tasks against, and can be used to define host-specific variables and group-specific variables.\nAn inventory file is written in INI or YAML format, and can include the following information:\n Hostnames or IP addresses of target hosts Connection parameters such as the SSH username, SSH port, or WinRM settings Group definitions, which allow hosts to be grouped together and managed collectively Variables, which can be assigned to individual hosts or groups  For example, an inventory file might look like this:\n1 2 3 4 5 6 7 8 9 10  [webservers] web1.example.com web2.example.com [databases] db1.example.com db2.example.com [all:vars] ansible_user=ubuntu   Playbooks An Ansible playbook is a set of instructions that define the desired state of a system, and the steps required to achieve that state.\nPlaybooks are also written in YAML format.\nA typical playbook consists of one or more “plays”, each of which specifies a set of tasks to be executed on a target host or group of hosts.\nEach task defines a set of actions to be performed, such as installing a package, editing a configuration file, or executing a command.\nTasks are executed in a sequential order by utilizing the declarative syntax in YAML to determine the order of execution and the dependencies between tasks.\nPlaybooks can also include variables, which can be used to define reusable values or parameters that can be passed between tasks or plays.\nFor example, here is a playbook which checks for updates on a remote Ubuntu host:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  ---- name:Check for updates on Ubuntuhosts:192.168.2.100become:truetasks:- name:Update apt cacheapt:update_cache:yes- name:Check for updatesapt:upgrade:distupdate_cache:yes  Getting Started Windows Ansible can be installed on Windows using Windows Subsystem for Linux (WSL) or a virtual machine (VM).\n If you don’t already use WSL, follow the instructions on Microsoft’s website on setting up a WSL machine. Install a Linux distribution such as Ubuntu or Debian from the Microsoft Store, or use this guide. Once you have your Linux machine up and running, run:  1 2  sudo apt update sudo apt install ansible -y   Mac OS If you are using Mac OS, you can use Homebrew, a popular package manager for Mac OS.\n1  brew install ansible   Ubuntu/Debian-based If you are on Ubuntu, or any Debian-based system, you can use the apt package manager.\n1 2  sudo apt update sudo apt install ansible -y   Verify Ansible is installed and working:\n1  ansible --version   1 2 3 4 5 6 7 8 9  ansible [core 2.11.4] config file = None configured module search path = ['/home/devops/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/share/lib64/python3.6/site-packages/ansible ansible collection location = /home/devops/.ansible/collections:/usr/share/ansible/collections executable location = /home/devops/.local/bin/ansible python version = 3.6.12 (default, Sep 15 2020, 12:49:50) [GCC 4.8.5 20150623 (Red Hat 4.8.5-37)] jinja version = 2.11.3 libyaml = True   SSH Keys Make sure you have access to your hosts with ssh keys.\nYou can generate a key-pair with:\n1  ssh-keygen   Then you can copy the keys to the control node with:\n1  ssh-copy-id username@remote_host   If you need more information, check out this short guide.\nSetup Inventory File You can start by creating an inventory file that lists the IP addresses or hostnames of the machines you want to manage, keep in mind this can be done in both INI or YAML format.\nIn this case, we’ll create one in an .ini file.\ninventory.ini\n1 2 3  [webservers] 192.168.2.100 192.168.2.101   Playbook Then create your playbook file to “describe” the desired state of your infrastructure.\nplaybook.yml\n1 2 3 4 5 6 7 8 9  ---- hosts:webserversbecome:truetasks:- name:Install Apache web serverapt:name:apache2state:present  Run the playbook by using ansible-playbook -i  .  1  ansible-playbook -i inventory.ini playbook.yml   This will run the playbook and configure the machines listed in the inventory file.\nPractical Uses Provisioning Multiple Servers You can create a playbook that defines the desired configuration for any number of new servers defined in your inventory file, and run it to deploy them automatically without the need for manual configuration, which definitely saves you time, and reduces the likeliness of errors.\nDeploying Applications Ansible can also be used to deploy applications automatically across a variety of hosts.\nApache Example For example, we can setup a simple Apache server to run on a given host in our inventory. This can further be extended if we need to run this on multiple hosts in our inventory file.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  ---- name:quick-apache-1hosts:192.168.2.100become:truetasks:- name:Update apt cacheapt:update_cache:yes- name:Install Apache2 packageapt:name:apache2state:present- name:Enable Apache2 serviceservice:name:apache2enabled:yesstate:started- name:Create index.html filecopy:content:\"Hello, world!\"dest:/var/www/html/index.html  The above playbook should setup an Apache web server on host 192.168.2.100.\nAnsible will let us know when the playbook has been completed and report back a status update like below:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  PLAY [quick-apache-1] **************************************************************** TASK [Gathering Facts] *************************************************************** ok: [192.168.2.100] TASK [Update apt cache] *************************************************************** changed: [192.168.2.100] TASK [Install Apache2 package] ******************************************************** changed: [192.168.2.100] TASK [Enable Apache2 service] ********************************************************* changed: [192.168.2.100] TASK [Create index.html file] ********************************************************* changed: [192.168.2.100] PLAY RECAP **************************************************************************** 192.168.2.100 : ok=5 changed=4 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0   Managing Network Devices Ansible can also be used to manage network devices, such as switches and routers.\nYou can create a playbook that defines the desired configuration for your network devices.\nThis makes it easy to manage your network infrastructure and ensures consistency across your devices.\nManaging Edgerouter X Firewall Rules For example, we can modify firewall rules and manage our Edgerouter X from a playbook file.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36  ---- name:Configure EdgeRouter X firewallhosts:192.168.2.1gather_facts:nobecome:truevars:firewall_rules:- rule_number:10action:acceptprotocol:tcpdestination_port:22- rule_number:20action:acceptprotocol:tcpdestination_port:80- rule_number:30action:acceptprotocol:tcpdestination_port:443- rule_number:40action:dropprotocol:allsource:192.168.2.0/24state:newtasks:- name:Add firewall rulesedgemax_firewall:rule_number:\"{{ item.rule_number }}\"action:\"{{ item.action }}\"protocol:\"{{ item.protocol }}\"destination_port:\"{{ item.destination_port }}\"source:\"{{ item.source | default(omit) }}\"state:\"{{ item.state | default(omit) }}\"with_items:\"{{ firewall_rules }}\"  Conclusion In conclusion, automating your infrastructure with Ansible can save time, reduce errors, and make your life easier.\nYou can easily provision new servers, deploy applications, and manage your network devices all from within a file.\nLearn More If you wish to learn more, make sure to check out the official documentation, and the community’s self-paced lab training.\n","wordCount":"1165","inLanguage":"en","datePublished":"2023-04-06T16:35:08-05:00","dateModified":"2023-04-06T16:35:08-05:00","author":{"@type":"Person","name":"Angel"},"mainEntityOfPage":{"@type":"WebPage","@id":"/posts/2023-04/automate-your-infrastructure-with-ansible/"},"publisher":{"@type":"Organization","name":"NS","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href accesskey=h title="NS (Alt + H)">NS</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=/blog/ title=Blog>
<span>Blog</span>
</a>
</li>
<li>
<a href=tags/ title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=/projects/ title=Projects>
<span>Projects</span>
</a>
</li>
<li>
<a href=/contact/ title=Contact>
<span>Contact</span>
</a>
</li>
<li>
<a href=/about/ title=About>
<span>About</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href>Home</a>&nbsp;»&nbsp;<a href=/posts/>Posts</a></div>
<h1 class=post-title>
Automate Your Infrastructure With Ansible
</h1>
<div class=post-meta><span title="2023-04-06 16:35:08 -0500 CDT">April 6, 2023</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1165 words&nbsp;·&nbsp;Angel
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#intro aria-label=Intro>Intro</a></li>
<li>
<a href=#components aria-label=Components>Components</a><ul>
<li>
<a href=#inventory aria-label=Inventory>Inventory</a></li>
<li>
<a href=#playbooks aria-label=Playbooks>Playbooks</a></li></ul>
</li>
<li>
<a href=#getting-started aria-label="Getting Started">Getting Started</a><ul>
<li>
<a href=#windows aria-label=Windows>Windows</a></li>
<li>
<a href=#mac-os aria-label="Mac OS">Mac OS</a></li>
<li>
<a href=#ubuntudebian-based aria-label=Ubuntu/Debian-based>Ubuntu/Debian-based</a></li>
<li>
<a href=#ssh-keys aria-label="SSH Keys">SSH Keys</a></li></ul>
</li>
<li>
<a href=#setup aria-label=Setup>Setup</a><ul>
<li>
<a href=#inventory-file aria-label="Inventory File">Inventory File</a></li>
<li>
<a href=#playbook aria-label=Playbook>Playbook</a></li></ul>
</li>
<li>
<a href=#practical-uses aria-label="Practical Uses">Practical Uses</a><ul>
<li>
<a href=#provisioning-multiple-servers aria-label="Provisioning Multiple Servers">Provisioning Multiple Servers</a></li>
<li>
<a href=#deploying-applications aria-label="Deploying Applications">Deploying Applications</a><ul>
<li>
<a href=#apache-example aria-label="Apache Example">Apache Example</a></li></ul>
</li>
<li>
<a href=#managing-network-devices aria-label="Managing Network Devices">Managing Network Devices</a><ul>
<li>
<a href=#managing-edgerouter-x-firewall-rules aria-label="Managing Edgerouter X Firewall Rules">Managing Edgerouter X Firewall Rules</a></li></ul>
</li></ul>
</li>
<li>
<a href=#conclusion aria-label=Conclusion>Conclusion</a></li>
<li>
<a href=#learn-more aria-label="Learn More">Learn More</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>Automating your infrastructure with Ansible can be a game-changer for any organization looking to streamline their processes and reduce manual labor.</p>
<h2 id=intro>Intro<a hidden class=anchor aria-hidden=true href=#intro>#</a></h2>
<p><a href=https://www.ansible.com/>Ansible</a> is an open-source automation tool that allows you to automate tasks such as configuration management, application deployment, and orchestration of infrastructure resources, using a declarative language to describe the desired state of a system.</p>
<p>One of the key benefits of Ansible is its simplicity and ease of use.</p>
<p>Here&rsquo;s a quick overview from <a href=https://fireship.io/>Fireship.io</a>.</p>
<div class=embed-youtube data-video-id=xRMPKQweySE>
<div class=embed-youtube-play></div>
</div>
<script src=/js/custom.js></script>
<h2 id=components>Components<a hidden class=anchor aria-hidden=true href=#components>#</a></h2>
<h3 id=inventory>Inventory<a hidden class=anchor aria-hidden=true href=#inventory>#</a></h3>
<p>An Ansible inventory file is a configuration file that contains a list of hosts and groups that Ansible can manage. The inventory file specifies the target hosts that Ansible should execute tasks against, and can be used to define host-specific variables and group-specific variables.</p>
<p>An inventory file is written in <code>INI</code> or <code>YAML</code> format, and can include the following information:</p>
<ul>
<li>Hostnames or IP addresses of target hosts</li>
<li>Connection parameters such as the SSH username, SSH port, or WinRM settings</li>
<li>Group definitions, which allow hosts to be grouped together and managed collectively</li>
<li>Variables, which can be assigned to individual hosts or groups</li>
</ul>
<p>For example, an inventory file might look like this:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=k>[webservers]</span>
<span class=na>web1.example.com</span>
<span class=na>web2.example.com</span>

<span class=k>[databases]</span>
<span class=na>db1.example.com</span>
<span class=na>db2.example.com</span>

<span class=k>[all:vars]</span>
<span class=na>ansible_user</span><span class=o>=</span><span class=s>ubuntu</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=playbooks>Playbooks<a hidden class=anchor aria-hidden=true href=#playbooks>#</a></h3>
<p>An Ansible playbook is a set of instructions that define the desired state of a system, and the steps required to achieve that state.</p>
<p>Playbooks are also written in <code>YAML</code> format.</p>
<p>A typical playbook consists of one or more &ldquo;plays&rdquo;, each of which specifies a set of tasks to be executed on a target host or group of hosts.</p>
<p>Each task defines a set of actions to be performed, such as installing a package, editing a configuration file, or executing a command.</p>
<p>Tasks are executed in a sequential order by utilizing the declarative syntax in <code>YAML</code> to determine the order of execution and the dependencies between tasks.</p>
<p>Playbooks can also include variables, which can be used to define reusable values or parameters that can be passed between tasks or plays.</p>
<p>For example, here is a playbook which checks for updates on a remote Ubuntu host:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=nn>---</span><span class=w>
</span><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Check for updates on Ubuntu</span><span class=w>
</span><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=m>192.168.2.100</span><span class=w>
</span><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>  
</span><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Update apt cache</span><span class=w>
</span><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>update_cache</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>    
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Check for updates</span><span class=w>
</span><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>upgrade</span><span class=p>:</span><span class=w> </span><span class=l>dist</span><span class=w>
</span><span class=w>        </span><span class=nt>update_cache</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><h2 id=getting-started>Getting Started<a hidden class=anchor aria-hidden=true href=#getting-started>#</a></h2>
<h3 id=windows>Windows<a hidden class=anchor aria-hidden=true href=#windows>#</a></h3>
<p>Ansible can be installed on Windows using Windows Subsystem for Linux (WSL) or a virtual machine (VM).</p>
<ul>
<li>If you don&rsquo;t already use WSL, follow the instructions on <a href=https://docs.microsoft.com/en-us/windows/wsl/install-win10>Microsoft&rsquo;s website</a> on setting up a WSL machine.</li>
<li>Install a Linux distribution such as Ubuntu or Debian from the Microsoft Store, or use <a href>this guide</a>.</li>
<li>Once you have your Linux machine up and running, run:</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo apt update
sudo apt install ansible -y
</code></pre></td></tr></table>
</div>
</div><h3 id=mac-os>Mac OS<a hidden class=anchor aria-hidden=true href=#mac-os>#</a></h3>
<p>If you are using Mac OS, you can use <a href=https://brew.sh/>Homebrew</a>, a popular package manager for Mac OS.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>brew install ansible
</code></pre></td></tr></table>
</div>
</div><h3 id=ubuntudebian-based>Ubuntu/Debian-based<a hidden class=anchor aria-hidden=true href=#ubuntudebian-based>#</a></h3>
<p>If you are on Ubuntu, or any Debian-based system, you can use the <code>apt</code> package manager.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo apt update
sudo apt install ansible -y
</code></pre></td></tr></table>
</div>
</div><p>Verify Ansible is installed and working:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>ansible --version
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>ansible [core 2.11.4]
  config file = None
  configured module search path = [&#39;/home/devops/.ansible/plugins/modules&#39;, &#39;/usr/share/ansible/plugins/modules&#39;]
  ansible python module location = /usr/share/lib64/python3.6/site-packages/ansible
  ansible collection location = /home/devops/.ansible/collections:/usr/share/ansible/collections
  executable location = /home/devops/.local/bin/ansible
  python version = 3.6.12 (default, Sep 15 2020, 12:49:50) [GCC 4.8.5 20150623 (Red Hat 4.8.5-37)]
  jinja version = 2.11.3
  libyaml = True
</code></pre></td></tr></table>
</div>
</div><h3 id=ssh-keys>SSH Keys<a hidden class=anchor aria-hidden=true href=#ssh-keys>#</a></h3>
<p>Make sure you have access to your hosts with ssh keys.</p>
<p>You can generate a key-pair with:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>ssh-keygen
</code></pre></td></tr></table>
</div>
</div><p>Then you can copy the keys to the control node with:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>ssh-copy-id username@remote_host
</code></pre></td></tr></table>
</div>
</div><p>If you need more information, check out this <a href=https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-20-04>short guide</a>.</p>
<h2 id=setup>Setup<a hidden class=anchor aria-hidden=true href=#setup>#</a></h2>
<h3 id=inventory-file>Inventory File<a hidden class=anchor aria-hidden=true href=#inventory-file>#</a></h3>
<p>You can start by creating an <strong>inventory file</strong> that lists the IP addresses or hostnames of the machines you want to manage, keep in mind this can be done in both <code>INI</code> or <code>YAML</code> format.</p>
<p>In this case, we&rsquo;ll create one in an <code>.ini</code> file.</p>
<p><code>inventory.ini</code></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=k>[webservers]</span>
<span class=na>192.168.2.100</span>
<span class=na>192.168.2.101</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=playbook>Playbook<a hidden class=anchor aria-hidden=true href=#playbook>#</a></h3>
<p>Then create your <code>playbook</code> file to &ldquo;describe&rdquo; the desired state of your infrastructure.</p>
<p><code>playbook.yml</code></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=nn>---</span><span class=w>
</span><span class=w></span>- <span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>webservers</span><span class=w>
</span><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install Apache web server</span><span class=w>
</span><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>apache2</span><span class=w>
</span><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><ol start=3>
<li>Run the playbook by using <code>ansible-playbook -i &lt;inventory> &lt;playbook></code>.</li>
</ol>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>ansible-playbook -i inventory.ini playbook.yml
</code></pre></td></tr></table>
</div>
</div><p>This will run the playbook and configure the machines listed in the inventory file.</p>
<h2 id=practical-uses>Practical Uses<a hidden class=anchor aria-hidden=true href=#practical-uses>#</a></h2>
<h3 id=provisioning-multiple-servers>Provisioning Multiple Servers<a hidden class=anchor aria-hidden=true href=#provisioning-multiple-servers>#</a></h3>
<p>You can create a playbook that defines the desired configuration for any number of new servers defined in your <code>inventory</code> file, and run it to deploy them automatically without the need for manual configuration, which definitely saves you time, and reduces the likeliness of errors.</p>
<h3 id=deploying-applications>Deploying Applications<a hidden class=anchor aria-hidden=true href=#deploying-applications>#</a></h3>
<p>Ansible can also be used to deploy applications automatically across a variety of hosts.</p>
<h4 id=apache-example>Apache Example<a hidden class=anchor aria-hidden=true href=#apache-example>#</a></h4>
<p>For example, we can setup a simple Apache server to run on a given host in our inventory. This can further be extended if we need to run this on multiple hosts in our inventory file.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=nn>---</span><span class=w>
</span><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>quick-apache-1</span><span class=w>
</span><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=m>192.168.2.100</span><span class=w>
</span><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>
</span><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Update apt cache</span><span class=w>
</span><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>update_cache</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install Apache2 package</span><span class=w>
</span><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>apache2</span><span class=w>
</span><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Enable Apache2 service</span><span class=w>
</span><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>apache2</span><span class=w>
</span><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>started</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Create index.html file</span><span class=w>
</span><span class=w>      </span><span class=nt>copy</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>content</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Hello, world!&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=l>/var/www/html/index.html</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>The above playbook should setup an Apache web server on host <code>192.168.2.100</code>.</p>
<p>Ansible will let us know when the playbook has been completed and report back a status update like below:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>PLAY [quick-apache-1] ****************************************************************

TASK [Gathering Facts] ***************************************************************
ok: [192.168.2.100]

TASK [Update apt cache] ***************************************************************
changed: [192.168.2.100]

TASK [Install Apache2 package] ********************************************************
changed: [192.168.2.100]

TASK [Enable Apache2 service] *********************************************************
changed: [192.168.2.100]

TASK [Create index.html file] *********************************************************
changed: [192.168.2.100]

PLAY RECAP ****************************************************************************
192.168.2.100              : ok=5    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0     
</code></pre></td></tr></table>
</div>
</div><h3 id=managing-network-devices>Managing Network Devices<a hidden class=anchor aria-hidden=true href=#managing-network-devices>#</a></h3>
<p>Ansible can also be used to manage network devices, such as switches and routers.</p>
<p>You can create a playbook that defines the desired configuration for your network devices.</p>
<p>This makes it easy to manage your network infrastructure and ensures consistency across your devices.</p>
<h4 id=managing-edgerouter-x-firewall-rules>Managing Edgerouter X Firewall Rules<a hidden class=anchor aria-hidden=true href=#managing-edgerouter-x-firewall-rules>#</a></h4>
<p>For example, we can modify firewall rules and manage our Edgerouter X from a playbook file.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=nn>---</span><span class=w>
</span><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Configure EdgeRouter X firewall</span><span class=w>
</span><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=m>192.168.2.1</span><span class=w>
</span><span class=w>  </span><span class=nt>gather_facts</span><span class=p>:</span><span class=w> </span><span class=kc>no</span><span class=w>
</span><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>  
</span><span class=w>  </span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>firewall_rules</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>rule_number</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>accept</span><span class=w>
</span><span class=w>        </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>tcp</span><span class=w>
</span><span class=w>        </span><span class=nt>destination_port</span><span class=p>:</span><span class=w> </span><span class=m>22</span><span class=w>
</span><span class=w>      </span>- <span class=nt>rule_number</span><span class=p>:</span><span class=w> </span><span class=m>20</span><span class=w>
</span><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>accept</span><span class=w>
</span><span class=w>        </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>tcp</span><span class=w>
</span><span class=w>        </span><span class=nt>destination_port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span><span class=w>      </span>- <span class=nt>rule_number</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>accept</span><span class=w>
</span><span class=w>        </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>tcp</span><span class=w>
</span><span class=w>        </span><span class=nt>destination_port</span><span class=p>:</span><span class=w> </span><span class=m>443</span><span class=w>
</span><span class=w>      </span>- <span class=nt>rule_number</span><span class=p>:</span><span class=w> </span><span class=m>40</span><span class=w>
</span><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>drop</span><span class=w>
</span><span class=w>        </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>all</span><span class=w>
</span><span class=w>        </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class=m>192.168.2.0</span><span class=l>/24</span><span class=w>
</span><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>new</span><span class=w>
</span><span class=w>
</span><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add firewall rules</span><span class=w>
</span><span class=w>      </span><span class=nt>edgemax_firewall</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>rule_number</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item.rule_number }}&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item.action }}&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item.protocol }}&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>destination_port</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item.destination_port }}&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item.source | default(omit) }}&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item.state | default(omit) }}&#34;</span><span class=w>
</span><span class=w>      </span><span class=nt>with_items</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ firewall_rules }}&#34;</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2>
<p>In conclusion, automating your infrastructure with Ansible can save time, reduce errors, and make your life easier.</p>
<p>You can easily provision new servers, deploy applications, and manage your network devices all from within a file.</p>
<h2 id=learn-more>Learn More<a hidden class=anchor aria-hidden=true href=#learn-more>#</a></h2>
<p>If you wish to learn more, make sure to check out the <a href=https://docs.ansible.com/ansible/latest/getting_started/index.html>official documentation</a>, and the community&rsquo;s <a href=https://www.ansible.com/products/ansible-community-training>self-paced lab training</a>.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=/tags/ansible/>ansible</a></li>
<li><a href=/tags/automation/>automation</a></li>
<li><a href=/tags/iac/>IaC</a></li>
<li><a href=/tags/homelab/>homelab</a></li>
<li><a href=/tags/linux/>linux</a></li>
</ul>
<nav class=paginav>
<a class=next href=/posts/2023-04/build-a-quick-website-with-hugo/>
<span class=title>Next »</span>
<br>
<span>Build a Quick Website With Hugo</span>
</a>
</nav>
</footer><script src=https://utteranc.es/client.js repo=netsparse/main-site-hugo issue-term=pathname theme=photon-dark crossorigin=anonymous async></script>
</article>
</main>
<footer class=footer>
<span>&copy; 2023 <a href>NS</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>