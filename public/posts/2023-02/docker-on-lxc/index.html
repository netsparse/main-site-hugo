<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Running Docker containers in a Proxmox LXC container | Netsparse · Angel Nevarez</title><meta name=keywords content="homelab,docker,proxmox,linux,lxc,containers"><meta name=description content="One awesome feature in Proxmox VE is to run an LXC (Linux Container) directly from the web interface."><meta name=author content="Angel"><link rel=canonical href=https://netsparse.dev/posts/2023-02/docker-on-lxc/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://netsparse.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://netsparse.dev/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://netsparse.dev/favicon.ico><link rel=mask-icon href=https://netsparse.dev/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-H4GRFCYEJN"></script>
<script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H4GRFCYEJN",{anonymize_ip:!1})}</script><meta property="og:title" content="Running Docker containers in a Proxmox LXC container"><meta property="og:description" content="One awesome feature in Proxmox VE is to run an LXC (Linux Container) directly from the web interface."><meta property="og:type" content="article"><meta property="og:url" content="https://netsparse.dev/posts/2023-02/docker-on-lxc/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-15T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-15T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Running Docker containers in a Proxmox LXC container"><meta name=twitter:description content="One awesome feature in Proxmox VE is to run an LXC (Linux Container) directly from the web interface."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://netsparse.dev/posts/"},{"@type":"ListItem","position":3,"name":"Running Docker containers in a Proxmox LXC container","item":"https://netsparse.dev/posts/2023-02/docker-on-lxc/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Running Docker containers in a Proxmox LXC container","name":"Running Docker containers in a Proxmox LXC container","description":"One awesome feature in Proxmox VE is to run an LXC (Linux Container) directly from the web interface.\n","keywords":["homelab","docker","proxmox","linux","lxc","containers"],"articleBody":"One awesome feature in Proxmox VE is to run an LXC (Linux Container) directly from the web interface.\nA quick machine can be spun up that works and acts just like a regular full-blown Linux Virtual machine.\nThe downside to this is we are limited to what resources you provide the VM, not the resources that are given to an LXC (which is essentially the maximum of the host system).\nSide Note\nThis requires running an LXC as Unprivileged. To learn more about what this means, please refer to the Proxmox documentation, or check out the official LXC docs here.\nPreparing Proxmox Note: This will need to be done on each Proxmox host you have, so each command will need to be done for how ever many hosts you have Enable Kernel Modules\nThe overlay and aufs kernel modules need to be enabled to support running containers:\n1 echo -e \"overlay\\naufs\" \u003e\u003e /etc/modules-load.d/modules.conf Please note that the aufs module is deprecated as of Proxmox VE 7.0 This CAN be explicitly enabled, but it won’t do anything Reboot host For the changes to take effect, reboot the host\nCheck changes Upon starting back up, run the following:\n1 lsmod | grep -E 'over This should return something like:\n1 overlay 131072 3 Create an unprivileged container The creation process is pretty standard, and what you’re used to. But there are a few changes you will need to make along the way:\nOn the Proxmox GUI, click the Create CT button Make sure you have “Unprivileged container” checked For the rest of the setup, give it your preferred configuration Make sure you don’t start the container upon creation Edit container’s features Click on your new container\nGo to Options Double-click on the Features row Ensure that the following are checked: keyctl nesting Click OK Start the container Install Docker Head over to Docker’s docs, and find the steps to install docker for your distro.\nOnce all set up, test out the installation with docker run hello-world and it should be working!\nThis guide is based from Quinn Henry’s blog over at https://quibtech.com\n","wordCount":"350","inLanguage":"en","datePublished":"2023-02-15T00:00:00Z","dateModified":"2023-02-15T00:00:00Z","author":{"@type":"Person","name":"Angel"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://netsparse.dev/posts/2023-02/docker-on-lxc/"},"publisher":{"@type":"Organization","name":"Netsparse · Angel Nevarez","logo":{"@type":"ImageObject","url":"https://netsparse.dev/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://netsparse.dev accesskey=h title=Home><img src=/images/site-logo/cable-128.ico alt=logo aria-label=logo width=30 height=30></a></a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Dark/Light Mode)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://netsparse.dev/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://netsparse.dev/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://netsparse.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://netsparse.dev/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://netsparse.dev/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://netsparse.dev/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://netsparse.dev>Home</a>&nbsp;»&nbsp;<a href=https://netsparse.dev/posts/>Posts</a></div><h1 class=post-title>Running Docker containers in a Proxmox LXC container</h1><div class=post-meta><span title='2023-02-15 00:00:00 +0000 UTC'>February 15, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;350 words&nbsp;·&nbsp;Angel</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#preparing-proxmox aria-label="Preparing Proxmox">Preparing Proxmox</a></li><li><a href=#reboot-host aria-label="Reboot host">Reboot host</a></li><li><a href=#check-changes aria-label="Check changes">Check changes</a></li><li><a href=#create-an-unprivileged-container aria-label="Create an unprivileged container">Create an unprivileged container</a></li><li><a href=#edit-containers-features aria-label="Edit container’s features">Edit container’s features</a></li><li><a href=#install-docker aria-label="Install Docker">Install Docker</a></li></ul></div></details></div><div class=post-content><p>One awesome feature in Proxmox VE is to run an LXC (Linux Container) directly from the web interface.</p><p>A quick machine can be spun up that works and acts just like a regular full-blown Linux Virtual machine.</p><p>The downside to this is we are limited to what resources you provide the VM, not the resources that are given to an LXC (which is essentially the maximum of the host system).</p><p><strong>Side Note</strong></p><p>This requires running an LXC as <code>Unprivileged</code>. To learn more about what this means, please refer to the <a href=https://pve.proxmox.com/wiki/Unprivileged_LXC_containers>Proxmox documentation</a>, or check out the official LXC docs <a href=https://linuxcontainers.org/lxc/security/#unprivileged-containers>here</a>.</p><h2 id=preparing-proxmox>Preparing Proxmox<a hidden class=anchor aria-hidden=true href=#preparing-proxmox>#</a></h2><p><strong>Note: This will need to be done on each Proxmox host you have, so each command will need to be done for how ever many hosts you have Enable Kernel Modules</strong></p><p>The <code>overlay</code> and <code>aufs</code> kernel modules need to be enabled to support running containers:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;overlay\naufs&#34;</span> &gt;&gt; /etc/modules-load.d/modules.conf
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Please note that the aufs module is deprecated as of Proxmox VE 7.0
This CAN be explicitly enabled, but it won’t do anything</strong></li></ul><h2 id=reboot-host>Reboot host<a hidden class=anchor aria-hidden=true href=#reboot-host>#</a></h2><p>For the changes to take effect, reboot the host</p><h2 id=check-changes>Check changes<a hidden class=anchor aria-hidden=true href=#check-changes>#</a></h2><p>Upon starting back up, run the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lsmod <span class=p>|</span> grep -E <span class=err>&#39;</span>over
</span></span></code></pre></td></tr></table></div></div><p>This should return something like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>overlay               <span class=m>131072</span>  <span class=m>3</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=create-an-unprivileged-container>Create an unprivileged container<a hidden class=anchor aria-hidden=true href=#create-an-unprivileged-container>#</a></h2><p>The creation process is pretty standard, and what you’re used to. But there are a few changes you will need to make along the way:</p><ul><li>On the Proxmox GUI, click the Create CT button</li><li>Make sure you have “Unprivileged container” checked</li><li>For the rest of the setup, give it your preferred configuration</li><li>Make sure you don’t start the container upon creation</li></ul><h2 id=edit-containers-features>Edit container’s features<a hidden class=anchor aria-hidden=true href=#edit-containers-features>#</a></h2><p>Click on your new container</p><ul><li>Go to Options</li><li>Double-click on the Features row</li><li>Ensure that the following are checked:<ul><li><code>keyctl</code></li><li><code>nesting</code></li></ul></li><li>Click OK</li><li>Start the container</li></ul><h2 id=install-docker>Install Docker<a hidden class=anchor aria-hidden=true href=#install-docker>#</a></h2><p>Head over to <a href=https://docs.docker.com/engine/install/>Docker’s docs</a>, and find the steps to install docker for your distro.</p><p>Once all set up, test out the installation with <code>docker run hello-world</code> and it should be working!</p><p>This guide is based from Quinn Henry&rsquo;s blog over at <a href=https://quibtech.com/p/run-docker-containers-in-proxmox-lxc/>https://quibtech.com</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://netsparse.dev/tags/homelab/>homelab</a></li><li><a href=https://netsparse.dev/tags/docker/>docker</a></li><li><a href=https://netsparse.dev/tags/proxmox/>proxmox</a></li><li><a href=https://netsparse.dev/tags/linux/>linux</a></li><li><a href=https://netsparse.dev/tags/lxc/>lxc</a></li><li><a href=https://netsparse.dev/tags/containers/>containers</a></li></ul><nav class=paginav><a class=prev href=https://netsparse.dev/posts/2023-02/manage-your-docker-env-with-portainer/><span class=title>« Prev</span><br><span>Manage Your Docker Environment With Portainer</span></a>
<a class=next href=https://netsparse.dev/posts/2023-02/get-started-with-docker/><span class=title>Next »</span><br><span>Get Started with Docker</span></a></nav></footer><script src=https://utteranc.es/client.js repo=netsparse/main-site-hugo issue-term=pathname theme=photon-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://netsparse.dev>Netsparse · Angel Nevarez</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>